<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />
    <title>Retro Web Games</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&amp;display=swap" rel="stylesheet" />
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet" />
    <style>
        body {
            font-family: 'Press Start 2P', cursive;
            background-color: #000020;
            color: #00FF00;
            /* Added a fallback color and a more subtle background image */
            background-image: linear-gradient(rgba(0, 0, 32, 0.8), rgba(0, 0, 32, 0.95)), url("https://www.transparenttextures.com/patterns/stardust.png");
            background-attachment: fixed;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
            background-color: rgba(0, 0, 0, 0.6);
            padding: 20px;
            border-radius: 8px;
            border: 3px solid #FF00FF;
            box-shadow: 0 0 15px #FF00FF, inset 0 0 10px #FF00FF;
        }

        .header h1 {
            font-size: 2rem;
            color: #FFFF00;
            text-shadow: 3px 3px #FF00FF;
        }
        @media (min-width: 640px) {
            .header h1 {
                font-size: 3rem;
            }
        }


        .main-content {
            display: flex;
            flex-direction: column; /* Stack on mobile */
            gap: 20px;
        }
        @media (min-width: 1024px) {
            .main-content {
                flex-direction: row; /* Side-by-side on desktop */
            }
        }

        .game-catalog {
            flex: 1;
            background-color: rgba(0, 0, 0, 0.7);
            padding: 20px;
            border-radius: 8px;
            border: 2px solid #00FFFF;
            box-shadow: 0 0 10px #00FFFF;
        }

        .game-catalog h2 {
            font-size: 1.5rem;
            margin-bottom: 20px;
            color: #00FFFF;
            text-align: center;
        }

        .game-item {
            display: flex;
            align-items: center;
            padding: 10px;
            margin-bottom: 10px;
            border-radius: 6px;
            cursor: pointer;
            transition: background-color 0.3s, transform 0.2s;
            border: 1px solid #00FF00;
        }

        .game-item:hover, .game-item.active {
            background-color: rgba(0, 255, 0, 0.2);
            transform: scale(1.02);
            box-shadow: 0 0 8px #00FF00;
        }

        .game-item img {
            width: 60px;
            height: 60px;
            object-fit: cover;
            margin-right: 15px;
            border-radius: 4px;
            border: 2px solid #FFFF00;
            flex-shrink: 0;
        }

        .game-item-title {
            font-size: 1rem;
            color: #FFFFFF;
        }

        .game-display-area {
            flex: 3;
            background-color: rgba(0, 0, 0, 0.7);
            padding: 20px;
            border-radius: 8px;
            border: 2px solid #FF00FF;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start; /* Align to top */
            min-height: 500px;
        }

        .game-placeholder {
            width: 100%;
            height: 500px; /* Taller placeholder */
            background-color: #000000;
            border: 3px dashed #00FF00;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            border-radius: 8px;
            font-size: 1.2rem;
            color: #AAAAAA;
            position: relative;
        }

        .game-iframe {
            width: 100%;
            height: 500px; /* Taller iframe */
            border: none;
            border-radius: 8px;
            background-color: #000; /* Add a background color for loading */
        }

        .game-info {
            display: none; /* Hidden by default, shown on game load */
            flex-direction: column;
            gap: 20px;
            margin-top: 20px;
            width: 100%;
        }

        @media (min-width: 768px) {
            .game-info {
                flex-direction: row; /* Side by side on larger screens */
            }
        }


        .leaderboard,
        .comments {
            flex: 1;
            background-color: rgba(0, 0, 0, 0.7);
            padding: 20px;
            border-radius: 8px;
            border: 2px solid #FFFF00;
        }

        .leaderboard h3,
        .comments h3 {
            font-size: 1.2rem;
            margin-bottom: 15px;
            color: #FFFF00;
            text-align: center;
        }

        .leaderboard-item,
        .comment-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px dashed #00FF00;
            color: #FFFFFF;
        }
        .comment-item {
            flex-direction: column;
            align-items: flex-start;
        }

        .leaderboard-item:last-child,
        .comment-item:last-child {
            border-bottom: none;
        }

        .comment-input {
            width: 100%;
            padding: 10px;
            margin-top: 15px;
            background-color: #000010;
            border: 1px solid #00FF00;
            color: #00FF00;
            border-radius: 4px;
            font-family: 'Press Start 2P', cursive;
        }

        .comment-input::placeholder {
            color: #00AA00;
        }

        .submit-comment-btn {
            display: block;
            width: 100%;
            padding: 10px;
            margin-top: 10px;
            background-color: #FF00FF;
            color: #000000;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-family: 'Press Start 2P', cursive;
            transition: background-color 0.3s;
        }

        .submit-comment-btn:hover {
            background-color: #DD00DD;
        }

        .blinking-cursor {
            animation: blink 1s step-end infinite;
        }

        @keyframes blink {
            50% {
                opacity: 0;
            }
        }

        .material-icons {
            vertical-align: middle;
            margin-right: 5px;
            color: #00FFFF;
        }

        .game-item .material-icons {
            font-size: 24px;
        }

        .footer {
            text-align: center;
            margin-top: 40px;
            padding: 15px;
            font-size: 0.8rem;
            color: #AAAAAA;
            background-color: rgba(0, 0, 0, 0.6);
            border-top: 2px solid #00FFFF;
            border-radius: 8px 8px 0 0;
        }
    </style>
</head>

<body>
    <div class="container">
        <header class="header">
            <h1><span class="material-icons" style="font-size: inherit; color: #FFFF00; vertical-align: bottom;">gamepad</span> RETRO GAME ARCADE <span class="material-icons" style="font-size: inherit; color: #FFFF00; vertical-align: bottom;">joystick</span></h1>
        </header>
        <div class="main-content">
            <aside class="game-catalog">
                <h2><span class="material-icons">sports_esports</span> CHOOSE A GAME</h2>
                <div id="game-list">
                    <!-- Games will be dynamically added here -->
                </div>
            </aside>
            <main class="game-display-area">
                <div class="game-placeholder" id="game-screen">
                    <p>SELECT A GAME TO START<span class="blinking-cursor">_</span></p>
                </div>
                <div class="text-2xl mt-4 mb-2 text-center" id="game-title-display" style="color: #FF00FF; display:none;"></div>
                <div class="game-info" id="game-info-section">
                    <section class="leaderboard">
                        <h3><span class="material-icons" style="color: #FFFF00;">leaderboard</span> LEADERBOARD</h3>
                        <div id="leaderboard-content">
                            <p class="text-center text-gray-400 py-4">No game selected.</p>
                        </div>
                    </section>
                    <section class="comments">
                        <h3><span class="material-icons" style="color: #FFFF00;">comment</span> COMMENTS</h3>
                        <div id="comments-content">
                            <p class="text-center text-gray-400 py-4">No game selected.</p>
                        </div>
                        <textarea class="comment-input" id="comment-input-field" placeholder="Type your comment..."></textarea>
                        <button class="submit-comment-btn" onclick="addComment()">SUBMIT COMMENT</button>
                    </section>
                </div>
            </main>
        </div>
        <footer class="footer">
            漏 198X Retro Web Games. All Rights Reserved (not really). Insert Coin to Continue.
        </footer>
    </div>
    <script>
        let currentGame = null;

        // --- Store full HTML for embeddable games ---
        const gameSources = {
            '3 Cups': `
                <!DOCTYPE html>
                <html lang="he" dir="rtl">
                <head>
                    <meta charset="UTF-8">
                    <meta name="viewport" content="width=device-width, initial-scale=1.0">
                    <title>砖拽 砖砖转 住转 - 转 </title>
                    <script src="https://cdn.tailwindcss.com"><\/script>
                    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
                    <style>
                        body {
                            font-family: 'Inter', sans-serif;
                            display: flex;
                            flex-direction: column;
                            justify-content: center;
                            align-items: center;
                            min-height: 100vh;
                            background-color: #f0f4f8;
                            overflow-x: hidden;
                            padding: 1rem;
                        }
                        .cup-container {
                            position: relative;
                            width: 90%;
                            max-width: 380px;
                            height: 130px;
                            display: flex;
                            justify-content: space-around;
                            align-items: flex-end;
                            margin-bottom: 2rem;
                        }
                        .cup {
                            width: 70px;
                            height: 90px;
                            background-color: #ef4444;
                            border-radius: 8px 8px 0 0;
                            position: absolute;
                            bottom: 0;
                            cursor: default;
                            transition: bottom 0.4s ease-in-out, left 0.3s ease-in-out, transform 0.3s ease-in-out;
                            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
                            display: flex;
                            justify-content: center;
                            align-items: center;
                            font-size: 1.8rem;
                            color: white;
                            user-select: none;
                        }
                        .cup.lifted { bottom: 60px; }
                        .gift {
                            width: 45px;
                            height: 45px;
                            font-size: 2.2rem;
                            line-height: 45px;
                            text-align: center;
                            position: absolute;
                            bottom: 5px;
                            left: 50%;
                            transform: translateX(-50%);
                            transition: left 0.3s ease-in-out, transform 0.3s ease-in-out, opacity 0.3s ease-in-out;
                            display: none;
                            user-select: none;
                            opacity: 0;
                            z-index: -1;
                        }
                        .gift.visible { display: flex; opacity: 1; z-index: 0; }
                        #startButton {
                            padding: 0.75rem 1.5rem;
                            font-size: 1rem;
                            font-weight: 600;
                            color: white;
                            background-color: #2563eb;
                            border: none;
                            border-radius: 0.5rem;
                            cursor: pointer;
                            transition: background-color 0.3s ease, transform 0.1s ease, box-shadow 0.2s ease;
                            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
                        }
                        #startButton:hover:not(:disabled) { background-color: #1d4ed8; box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15); }
                        #startButton:active:not(:disabled) { transform: scale(0.98); }
                        #startButton:disabled { background-color: #9ca3af; cursor: not-allowed; opacity: 0.7; }
                        #message { min-height: 4rem; font-weight: 500; color: #1f2937; margin-top: 1rem; text-align: center; width: 90%; max-width: 400px; line-height: 1.5; }
                        @keyframes throwTomato { 0% { transform: scale(0.1); opacity: 0.5; } 100% { transform: scale(1); opacity: 1; } }
                        #splat-overlay { position: fixed; inset: 0; display: flex; justify-content: center; align-items: center; z-index: 1000; font-size: 20vw; color: red; opacity: 0; pointer-events: none; display: none; transform: scale(1); }
                        #splat-overlay.visible { opacity: 1; pointer-events: auto; display: flex; animation: throwTomato 0.4s ease-in forwards; }
                        #joke-feedback { margin-top: 1rem; display: flex; gap: 1rem; justify-content: center; display: none; }
                        .feedback-button { padding: 0.6rem 1.1rem; font-size: 0.9rem; font-weight: 500; border-radius: 0.375rem; cursor: pointer; transition: background-color 0.3s ease, transform 0.1s ease; border: 1px solid transparent; }
                        #funny-button { background-color: #10b981; color: white; border-color: #059669; }
                        #funny-button:hover { background-color: #059669; }
                        #not-funny-button { background-color: #f87171; color: white; border-color: #ef4444; }
                        #not-funny-button:hover { background-color: #ef4444; }
                        .feedback-button:active { transform: scale(0.96); }
                    </style>
                </head>
                <body class="bg-gray-100 flex flex-col justify-center items-center min-h-screen">
                    <h1 class="text-2xl sm:text-3xl font-bold mb-6 text-gray-800 text-center">砖拽 砖砖转 住转</h1>
                    <div id="game-area" class="flex flex-col items-center w-full px-2 sm:px-4">
                        <div class="cup-container mb-6">
                            <div id="cup1" class="cup"></div>
                            <div id="cup2" class="cup"></div>
                            <div id="cup3" class="cup"></div>
                            <div id="gift" class="gift"></div>
                        </div>
                        <div class="text-center w-full">
                            <button id="startButton" class="mb-4">砖拽</button>
                            <p id="message" class="text-base sm:text-lg text-gray-700"></p>
                            <div id="joke-feedback">
                                <button id="funny-button" class="feedback-button">爪拽 </button>
                                <button id="not-funny-button" class="feedback-button"> 爪拽 </button>
                            </div>
                        </div>
                    </div>
                    <div id="splat-overlay"></div>
                    <script>
                        const cups = Array.from(document.querySelectorAll('.cup'));
                        const gift = document.getElementById('gift');
                        const startButton = document.getElementById('startButton');
                        const message = document.getElementById('message');
                        const cupContainer = document.querySelector('.cup-container');
                        const splatOverlay = document.getElementById('splat-overlay');
                        const jokeFeedbackContainer = document.getElementById('joke-feedback');
                        const funnyButton = document.getElementById('funny-button');
                        const notFunnyButton = document.getElementById('not-funny-button');
                        let giftHolderElement = null;
                        let shuffling = false;
                        let canGuess = false;
                        let activeTimeoutId = null;
                        const revealTime = 1000;
                        const liftTime = 400;
                        const shuffleSwapTime = 300;
                        const shuffleDuration = 3000;
                        const swapsPerShuffle = Math.floor(shuffleDuration / (shuffleSwapTime + 50));
                        const splatDuration = 1500;
                        const giftFadeTime = 300;
                        const splatAnimationTime = 400;
                        const splatFadeOutTime = 300;
                        const cupSlots = [
                            { left: '10%', transform: 'translateX(0%)' },
                            { left: '50%', transform: 'translateX(-50%)' },
                            { left: '90%', transform: 'translateX(-100%)' }
                        ];
                        const jokes = ['    砖拽 专?   抓.', ' 砖 转拽砖专  砖?  拽砖 注 住驻专.', ' 专 住 转 住拽 砖 转驻专专 转? "转  注".', ' 注爪   转 住驻专?   驻 .'];
                        function clearActiveTimeout() { if (activeTimeoutId) { clearTimeout(activeTimeoutId); activeTimeoutId = null; } }
                        function resetCupPositions() {
                            cups.forEach((cupEl, index) => {
                                Object.assign(cupEl.style, cupSlots[index]);
                                cupEl.classList.remove('lifted', 'shuffling');
                                cupEl.dataset.slot = index;
                            });
                            gift.classList.remove('visible');
                            gift.style.display = 'none';
                            splatOverlay.classList.remove('visible');
                            splatOverlay.style.display = 'none';
                            splatOverlay.style.animation = 'none';
                            jokeFeedbackContainer.style.display = 'none';
                        }
                        function setupNewRound() {
                            clearActiveTimeout();
                            message.textContent = '转...';
                            canGuess = false;
                            shuffling = false;
                            startButton.disabled = true;
                            removeGuessListeners();
                            resetCupPositions();
                            const giftCupIndex = Math.floor(Math.random() * cups.length);
                            giftHolderElement = cups[giftCupIndex];
                            const winningSlot = cupSlots[giftCupIndex];
                            Object.assign(gift.style, winningSlot);
                            giftHolderElement.classList.add('lifted');
                            gift.style.display = 'flex';
                            activeTimeoutId = setTimeout(() => { gift.classList.add('visible'); }, 10);
                            activeTimeoutId = setTimeout(() => {
                                giftHolderElement.classList.remove('lifted');
                                gift.classList.remove('visible');
                                activeTimeoutId = setTimeout(() => { gift.style.display = 'none'; startShuffle(); }, Math.max(liftTime, giftFadeTime));
                            }, revealTime);
                        }
                        function startShuffle() {
                            message.textContent = '...注专';
                            shuffling = true;
                            clearActiveTimeout();
                            let shuffleCount = 0;
                            const shuffleInterval = shuffleSwapTime + 50;
                            function performShuffleStep() {
                                if (!shuffling) return;
                                if (shuffleCount >= swapsPerShuffle) { endShuffle(); return; }
                                shuffleSinglePair();
                                shuffleCount++;
                                activeTimeoutId = setTimeout(performShuffleStep, shuffleInterval);
                            }
                            performShuffleStep();
                        }
                        function endShuffle() {
                            shuffling = false;
                            canGuess = true;
                            message.textContent = '专 住!';
                            addGuessListeners();
                            cups.forEach(cupEl => cupEl.classList.remove('shuffling'));
                            activeTimeoutId = null;
                        }
                        function shuffleSinglePair() {
                            let index1 = Math.floor(Math.random() * cups.length);
                            let index2 = Math.floor(Math.random() * cups.length);
                            while (index1 === index2) { index2 = Math.floor(Math.random() * cups.length); }
                            const cup1 = cups[index1];
                            const cup2 = cups[index2];
                            const slotIndex1 = parseInt(cup1.dataset.slot);
                            const slotIndex2 = parseInt(cup2.dataset.slot);
                            Object.assign(cup1.style, cupSlots[slotIndex2]);
                            Object.assign(cup2.style, cupSlots[slotIndex1]);
                            cup1.dataset.slot = slotIndex2;
                            cup2.dataset.slot = slotIndex1;
                        }
                        function handleGuess(event) {
                            if (!canGuess || shuffling) return;
                            canGuess = false;
                            removeGuessListeners();
                            clearActiveTimeout();
                            const chosenCup = event.currentTarget;
                            chosenCup.classList.add('lifted');
                            if (chosenCup === giftHolderElement) {
                                const correctSlotIndex = parseInt(chosenCup.dataset.slot);
                                Object.assign(gift.style, cupSlots[correctSlotIndex]);
                                gift.style.display = 'flex';
                                setTimeout(() => { gift.classList.add('visible'); }, 10);
                                const randomJoke = jokes[Math.floor(Math.random() * jokes.length)];
                                message.innerHTML = ' ! 砖转 ! <br><br>  砖:<br><i>' + randomJoke + '</i>';
                                jokeFeedbackContainer.style.display = 'flex';
                            } else {
                                message.textContent = '驻住! 注转...';
                                splatOverlay.style.animation = 'none';
                                splatOverlay.offsetHeight;
                                splatOverlay.style.animation = '';
                                splatOverlay.style.display = 'flex';
                                splatOverlay.classList.add('visible');
                                activeTimeoutId = setTimeout(() => {
                                    splatOverlay.classList.remove('visible');
                                    activeTimeoutId = setTimeout(() => { splatOverlay.style.display = 'none'; splatOverlay.style.animation = 'none'; }, splatFadeOutTime);
                                    chosenCup.classList.remove('lifted');
                                    activeTimeoutId = setTimeout(() => {
                                        const correctSlotIndex = parseInt(giftHolderElement.dataset.slot);
                                        Object.assign(gift.style, cupSlots[correctSlotIndex]);
                                        giftHolderElement.classList.add('lifted');
                                        gift.style.display = 'flex';
                                        setTimeout(() => { gift.classList.add('visible'); }, 10);
                                        message.textContent = '驻住! 注转. 转 转 .';
                                        activeTimeoutId = setTimeout(() => {
                                            startButton.disabled = false;
                                            message.textContent = '抓 "砖拽" 砖拽 砖.';
                                            giftHolderElement.classList.remove('lifted');
                                            gift.classList.remove('visible');
                                            activeTimeoutId = setTimeout(() => { gift.style.display = 'none'; }, giftFadeTime);
                                        }, 2000);
                                    }, liftTime + 50);
                                }, splatDuration);
                            }
                        }
                        function addGuessListeners() { cups.forEach(cup => { cup.addEventListener('click', handleGuess); cup.style.cursor = 'pointer'; }); }
                        function removeGuessListeners() { cups.forEach(cup => { cup.removeEventListener('click', handleGuess); cup.style.cursor = 'default'; }); }
                        function handleFeedbackClick() {
                            jokeFeedbackContainer.style.display = 'none';
                            message.textContent = '';
                            const liftedCup = document.querySelector('.cup.lifted');
                            if (liftedCup) { liftedCup.classList.remove('lifted'); }
                            gift.classList.remove('visible');
                            setTimeout(() => { gift.style.display = 'none'; setupNewRound(); }, Math.max(liftTime, giftFadeTime) + 50);
                        }
                        startButton.addEventListener('click', setupNewRound);
                        funnyButton.addEventListener('click', handleFeedbackClick);
                        notFunnyButton.addEventListener('click', handleFeedbackClick);
                        window.addEventListener('load', () => {
                            resetCupPositions();
                            message.textContent = '抓 注 "砖拽"  转!';
                            startButton.disabled = false;
                        });
                    <\/script>
                </body>
                </html>
            `,
            'Flappy Bird': `
                <!DOCTYPE html>
                <html lang="en">
                <head>
                    <meta charset="UTF-8">
                    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
                    <title>Flappy Bird</title>
                    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
                    <style>
                        body { display: flex; justify-content: center; align-items: center; min-height: 100vh; background-color: #87CEEB; margin: 0; font-family: 'Press Start 2P', cursive; flex-direction: column; overflow: hidden; }
                        #game-container { position: relative; width: 100%; max-width: 400px; }
                        canvas { border: 5px solid #333; display: block; background-color: #70c5ce; width: 100%; height: auto; aspect-ratio: 400 / 600; box-shadow: 0 10px 20px rgba(0,0,0,0.2); border-radius: 10px; }
                        #scoreDisplay { font-size: 1.5em; color: #fff; text-shadow: 2px 2px #000; margin-bottom: 15px; position: absolute; top: -40px; left: 50%; transform: translateX(-50%); }
                        #messageBox { display: none; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background-color: rgba(0, 0, 0, 0.7); color: white; padding: 20px; border-radius: 15px; text-align: center; font-size: 1.2em; z-index: 10; border: 3px solid #fff; }
                        #messageText { margin-bottom: 20px; }
                        button { font-family: 'Press Start 2P', cursive; padding: 15px 30px; font-size: 1em; cursor: pointer; background-color: #FFD700; color: #333; border: 3px solid #DAA520; border-radius: 10px; box-shadow: 0 5px 10px rgba(0,0,0,0.2); transition: background-color 0.2s, transform 0.1s; margin-top: 10px; }
                        button:hover { background-color: #f0c400; }
                        button:active { transform: translateY(2px); box-shadow: 0 3px 5px rgba(0,0,0,0.2); }
                    </style>
                </head>
                <body>
                    <div id="game-container">
                        <div id="scoreDisplay">Score: 0</div>
                        <canvas id="gameCanvas"></canvas>
                        <div id="messageBox">
                            <div id="messageText">Click or Tap to Start!</div>
                            <button id="actionButton">Start</button>
                        </div>
                    </div>
                    <script>
                        const canvas = document.getElementById('gameCanvas');
                        const ctx = canvas.getContext('2d');
                        const scoreDisplay = document.getElementById('scoreDisplay');
                        const messageBox = document.getElementById('messageBox');
                        const messageText = document.getElementById('messageText');
                        const actionButton = document.getElementById('actionButton');
                        let birdWidth, birdHeight, pipeWidth, gap, gravity, lift, pipeSpeed;
                        let birdX, birdY, birdVelocity, score, pipes, frameCount, gameStarted, gameOver, animationFrameId, isFlapping, flapAnimationTimer;
                        const flapDuration = 8;
                        function setScale() {
                            const baseWidth = 400;
                            const scale = canvas.width / baseWidth;
                            birdWidth = 34 * scale;
                            birdHeight = 24 * scale;
                            pipeWidth = 60 * scale;
                            gap = 150 * scale;
                            gravity = 0.4 * scale;
                            lift = -8 * scale;
                            pipeSpeed = 3 * scale;
                        }
                        function drawBird() {
                            ctx.save();
                            ctx.translate(birdX + birdWidth / 2, birdY + birdHeight / 2);
                            ctx.fillStyle = '#FFD700';
                            ctx.beginPath();
                            ctx.ellipse(0, 0, birdWidth / 2, birdHeight / 2, 0, 0, Math.PI * 2);
                            ctx.fill();
                            ctx.fillStyle = '#FFA500';
                            ctx.beginPath();
                            if (isFlapping) { ctx.moveTo(-birdWidth / 4, 0); ctx.lineTo(0, -birdHeight / 3); ctx.lineTo(birdWidth / 4, 0); ctx.lineTo(0, birdHeight / 6); }
                            else { ctx.moveTo(-birdWidth / 4, 0); ctx.lineTo(0, birdHeight / 3); ctx.lineTo(birdWidth / 4, 0); ctx.lineTo(0, birdHeight / 4); }
                            ctx.closePath();
                            ctx.fill();
                            ctx.fillStyle = '#000000';
                            ctx.beginPath();
                            ctx.arc(birdWidth / 4, -birdHeight / 6, 2 * (canvas.width / 400), 0, Math.PI * 2);
                            ctx.fill();
                            ctx.fillStyle = '#FFA500';
                            ctx.beginPath();
                            ctx.moveTo(birdWidth / 2 - 2, -2);
                            ctx.lineTo(birdWidth / 2 + (6 * (canvas.width/400)), 0);
                            ctx.lineTo(birdWidth / 2 - 2, 2);
                            ctx.closePath();
                            ctx.fill();
                            ctx.restore();
                            if (isFlapping) { flapAnimationTimer++; if (flapAnimationTimer >= flapDuration) { isFlapping = false; flapAnimationTimer = 0; } }
                        }
                        function updateBird() {
                            if (!gameStarted) return;
                            birdVelocity += gravity;
                            birdY += birdVelocity;
                            if (birdY < 0) { birdY = 0; birdVelocity = 0; }
                            if (birdY + birdHeight > canvas.height) { birdY = canvas.height - birdHeight; endGame(); }
                        }
                        function flap() { if (!gameOver) { birdVelocity = lift; isFlapping = true; flapAnimationTimer = 0; } }
                        function drawPipes() {
                            ctx.fillStyle = '#228B22';
                            pipes.forEach(pipe => {
                                ctx.fillRect(pipe.x, 0, pipeWidth, pipe.topHeight);
                                ctx.fillRect(pipe.x, canvas.height - pipe.bottomHeight, pipeWidth, pipe.bottomHeight);
                            });
                        }
                        function updatePipes() {
                            if (!gameStarted) return;
                            if (frameCount % 90 === 0) {
                                const minHeight = 50 * (canvas.width/400);
                                const maxHeight = canvas.height - gap - minHeight;
                                const topHeight = Math.random() * (maxHeight - minHeight) + minHeight;
                                pipes.push({ x: canvas.width, topHeight: topHeight, bottomHeight: canvas.height - topHeight - gap, passed: false });
                            }
                            pipes.forEach(pipe => {
                                pipe.x -= pipeSpeed;
                                if (birdX < pipe.x + pipeWidth && birdX + birdWidth > pipe.x && (birdY < pipe.topHeight || birdY + birdHeight > canvas.height - pipe.bottomHeight)) { endGame(); return; }
                                if (!pipe.passed && pipe.x + pipeWidth < birdX) { score++; pipe.passed = true; updateScoreDisplay(); }
                            });
                            pipes = pipes.filter(pipe => pipe.x + pipeWidth > 0);
                            frameCount++;
                        }
                        function updateScoreDisplay() { scoreDisplay.textContent = 'Score: ' + score; }
                        function showMessage(text, buttonText) { messageText.textContent = text; actionButton.textContent = buttonText; messageBox.style.display = 'flex'; messageBox.style.flexDirection = 'column'; messageBox.style.alignItems = 'center'; }
                        function hideMessage() { messageBox.style.display = 'none'; }
                        function resetGame() {
                            setScale();
                            birdX = 50 * (canvas.width/400);
                            birdY = canvas.height / 2 - birdHeight / 2;
                            birdVelocity = 0;
                            score = 0;
                            pipes = [];
                            frameCount = 0;
                            gameOver = false;
                            gameStarted = false;
                            isFlapping = false;
                            flapAnimationTimer = 0;
                            updateScoreDisplay();
                            hideMessage();
                            if (animationFrameId) { cancelAnimationFrame(animationFrameId); }
                            ctx.clearRect(0, 0, canvas.width, canvas.height);
                            drawBird();
                            showMessage("Click or Tap to Start!", "Start");
                        }
                        function startGame() {
                            if (!gameStarted) {
                                if (gameOver) resetGame();
                                gameStarted = true;
                                gameOver = false;
                                hideMessage();
                                gameLoop();
                            }
                        }
                        function endGame() { if (!gameOver) { gameOver = true; gameStarted = false; isFlapping = false; cancelAnimationFrame(animationFrameId); showMessage('Game Over! Score: ' + score, "Restart"); } }
                        function gameLoop() {
                            if (gameOver) return;
                            ctx.clearRect(0, 0, canvas.width, canvas.height);
                            drawPipes();
                            drawBird();
                            updateBird();
                            updatePipes();
                            animationFrameId = requestAnimationFrame(gameLoop);
                        }
                        function handleInput() { if (!gameStarted && !gameOver) { startGame(); } if (gameStarted && !gameOver) { flap(); } }
                        function init() {
                            const container = document.getElementById('game-container');
                            canvas.width = container.clientWidth;
                            canvas.height = container.clientWidth * (600/400);
                            resetGame();
                        }
                        canvas.addEventListener('click', handleInput);
                        window.addEventListener('keydown', (e) => { if (e.code === 'Space') { e.preventDefault(); if (gameOver) { resetGame(); } else { handleInput(); } } });
                        actionButton.addEventListener('click', () => { if (gameOver) { resetGame(); } else { startGame(); } });
                        window.addEventListener('load', init);
                        window.addEventListener('resize', init);
                    <\/script>
                </body>
                </html>
            `,
            'Ping Pong': `
                <!DOCTYPE html>
                <html>
                <head>
                <title>Simple Ping Pong</title>
                <style>
                  body { display: flex; flex-direction: column; justify-content: center; align-items: center; height: 100vh; background-color: #222; margin: 0; font-family: sans-serif; color: white; }
                  #gameContainer { position: relative; }
                  #gameArea { width: 600px; max-width: 90vw; height: 400px; max-height: 60vh; background-color: #000; border: 2px solid #fff; position: relative; overflow: hidden; cursor: none; }
                  .paddle { width: 15px; height: 80px; background-color: #fff; position: absolute; top: 160px; }
                  #paddleLeft { left: 10px; }
                  #paddleRight { right: 10px; }
                  #ball { width: 15px; height: 15px; background-color: #fff; border-radius: 50%; position: absolute; top: 192.5px; left: 292.5px; }
                  #scores { text-align: center; font-size: 2em; margin-bottom: 10px; }
                  #centerLine { position: absolute; top: 0; left: 50%; width: 2px; height: 100%; border-left: 4px dashed #555; transform: translateX(-50%); }
                  #instructions {text-align: center; margin-top: 10px; font-size: 0.8em;}
                </style>
                </head>
                <body>
                <div id="gameContainer">
                    <div id="scores"><span id="scoreLeft">0</span> - <span id="scoreRight">0</span></div>
                    <div id="gameArea">
                      <div id="centerLine"></div>
                      <div class="paddle" id="paddleLeft"></div>
                      <div class="paddle" id="paddleRight"></div>
                      <div id="ball"></div>
                    </div>
                     <div id="instructions">Left: W/S | Right: ArrowUp/Down</div>
                </div>
                <script>
                  const gameArea = document.getElementById('gameArea');
                  const paddleLeft = document.getElementById('paddleLeft');
                  const paddleRight = document.getElementById('paddleRight');
                  const ball = document.getElementById('ball');
                  const scoreLeftDisplay = document.getElementById('scoreLeft');
                  const scoreRightDisplay = document.getElementById('scoreRight');
                  let gameWidth, gameHeight, paddleHeight, paddleWidth, ballSize, paddleSpeed, ballSpeedX, ballSpeedY;
                  let ballX, ballY, paddleLeftY, paddleRightY, scoreLeft = 0, scoreRight = 0;
                  let keysPressed = {};
                  function setupDimensions() {
                      gameWidth = gameArea.offsetWidth;
                      gameHeight = gameArea.offsetHeight;
                      paddleHeight = paddleLeft.offsetHeight;
                      paddleWidth = paddleLeft.offsetWidth;
                      ballSize = ball.offsetWidth;
                      paddleSpeed = 6;
                      ballSpeedX = 3;
                      ballSpeedY = 3;
                      ballX = gameWidth / 2 - ballSize / 2;
                      ballY = gameHeight / 2 - ballSize / 2;
                      paddleLeftY = gameHeight / 2 - paddleHeight / 2;
                      paddleRightY = gameHeight / 2 - paddleHeight / 2;
                  }
                  document.addEventListener('keydown', (event) => { keysPressed[event.key] = true; });
                  document.addEventListener('keyup', (event) => { keysPressed[event.key] = false; });
                  function resetBall() {
                    ballX = gameWidth / 2 - ballSize / 2;
                    ballY = gameHeight / 2 - ballSize / 2;
                    ballSpeedX = (Math.random() > 0.5 ? 1 : -1) * 3;
                    ballSpeedY = (Math.random() > 0.5 ? 1 : -1) * (Math.random() * 2 + 2);
                  }
                  function gameLoop() {
                    if (keysPressed['w'] && paddleLeftY > 0) { paddleLeftY -= paddleSpeed; }
                    if (keysPressed['s'] && paddleLeftY < gameHeight - paddleHeight) { paddleLeftY += paddleSpeed; }
                    if (keysPressed['ArrowUp'] && paddleRightY > 0) { paddleRightY -= paddleSpeed; }
                    if (keysPressed['ArrowDown'] && paddleRightY < gameHeight - paddleHeight) { paddleRightY += paddleSpeed; }
                    paddleLeftY = Math.max(0, Math.min(paddleLeftY, gameHeight - paddleHeight));
                    paddleRightY = Math.max(0, Math.min(paddleRightY, gameHeight - paddleHeight));
                    ballX += ballSpeedX;
                    ballY += ballSpeedY;
                    if (ballY <= 0 || ballY >= gameHeight - ballSize) { ballSpeedY *= -1; ballY = Math.max(0, Math.min(ballY, gameHeight - ballSize)); }
                    if (ballX <= paddleWidth + 10 && ballX > 10 && ballY + ballSize > paddleLeftY && ballY < paddleLeftY + paddleHeight) {
                        if (ballSpeedX < 0) {
                            ballSpeedX *= -1.1;
                            let deltaY = ballY - (paddleLeftY + paddleHeight / 2);
                            ballSpeedY = deltaY * 0.2;
                            ballX = paddleWidth + 10;
                        }
                    }
                    if (ballX + ballSize >= gameWidth - paddleWidth - 10 && ballX + ballSize < gameWidth - 10 && ballY + ballSize > paddleRightY && ballY < paddleRightY + paddleHeight) {
                        if (ballSpeedX > 0) {
                            ballSpeedX *= -1.1;
                            let deltaY = ballY - (paddleRightY + paddleHeight / 2);
                            ballSpeedY = deltaY * 0.2;
                            ballX = gameWidth - paddleWidth - 10 - ballSize;
                        }
                    }
                    ballSpeedX = Math.max(-10, Math.min(10, ballSpeedX));
                    ballSpeedY = Math.max(-10, Math.min(10, ballSpeedY));
                    if (ballX < 0) { scoreRight++; scoreRightDisplay.textContent = scoreRight; resetBall(); }
                    else if (ballX + ballSize > gameWidth) { scoreLeft++; scoreLeftDisplay.textContent = scoreLeft; resetBall(); }
                    paddleLeft.style.top = paddleLeftY + 'px';
                    paddleRight.style.top = paddleRightY + 'px';
                    ball.style.left = ballX + 'px';
                    ball.style.top = ballY + 'px';
                    requestAnimationFrame(gameLoop);
                  }
                  window.addEventListener('resize', setupDimensions);
                  window.addEventListener('load', () => {
                      setupDimensions();
                      resetBall();
                      requestAnimationFrame(gameLoop);
                  });
                <\/script>
                </body>
                </html>
            `,
        };

        // --- All game metadata ---
        const allGames = [{
            name: '3 Cups',
            icon: 'https://placehold.co/60x60/ef4444/ffffff?text=3C',
            data: {
                leaderboard: [{ name: 'Guesser', score: 10 }, { name: 'Lucky', score: 8 }],
                comments: [{ user: 'ShellGamer', text: 'Where is the gift?!' }, ]
            }
        }, {
            name: 'Flappy Bird',
            icon: 'https://placehold.co/60x60/87CEEB/ffffff?text=FB',
            data: {
                leaderboard: [{ name: 'TopFlapper', score: 99 }, { name: 'Noob', score: 2 }],
                comments: [{ user: 'FlyHigh', text: 'This is hard!' }, ]
            }
        }, {
            name: 'Ping Pong',
            icon: 'https://placehold.co/60x60/ffffff/000000?text=PP',
            data: {
                leaderboard: [],
                comments: [{ user: 'Paddler', text: 'Classic fun.' }, ]
            }
        }, {
            name: 'Galaga',
            icon: 'https://lh3.googleusercontent.com/aida-public/AB6AXuCXZHKeVEaykNk76ulvtNRjpq7qV1xH0fZr_zZzKwbNFKrMyOqVHrn8pbHoCYQTmBN8KzcmQ6ako9erUlixEYdO83K1jXTwTIE71QmOe3VTlxY-YGCSxTGDn2WZv3iihCCQ9kxuxPaC70rvNaonBI5AwR3ihrs6rM8mnMgOuOOop4O8DsdVKr_rJ9K-Aw9NmediC2GbuGDl9OrwGciIhQyJ9Kf3ssuE6SmQHlJlOnDZrO0gFgatUBN3AphVg6K_V1R5HIriSPegxoc',
            data: {
                leaderboard: [{ name: 'StarFighter', score: 25000 }, { name: 'BugZapper', score: 23000 }, ],
                comments: [{ user: 'DualFighter', text: 'Two ships are better than one.' }, ]
            }
        }, {
            name: 'Frogger',
            icon: 'https://lh3.googleusercontent.com/aida-public/AB6AXuCttPgwIn6K5RdhXSg9_YeUqtBuJSTYfDl35cv0wHwS5Z4e4tGPWbEUFZduiu1ugopwZnLekI3WwVB0BX5tHtSZu3cIvh1WSGWFobIqW3a429SzXkZAsb7Wm7i1jfERZdlUKL6GTlLsFwHcrgiD023vi82Bhtkyc-f2k3Qrr_7CXHLVE2lYp56g8hhuxpz9ktYzHzlHf_pRig2yKbjybwXoZPYdv-VR0khkVmVkpW1_zIU4ovWHDOgP61QfpBj2ev55ixowb5UrdQI',
            data: {
                leaderboard: [{ name: 'LilyPadHopper', score: 5000 }, { name: 'RoadCrosser', score: 4000 }, ],
                comments: [{ user: 'FlyCatcher', text: 'So stressful but fun!' }, ]
            }
        }, ];

        const gameData = allGames.reduce((acc, game) => {
            acc[game.name] = game.data;
            return acc;
        }, {});


        function populateGameList() {
            const gameListContainer = document.getElementById('game-list');
            gameListContainer.innerHTML = ''; // Clear existing
            allGames.forEach(game => {
                const gameItem = document.createElement('div');
                gameItem.className = 'game-item';
                gameItem.setAttribute('data-game-name', game.name);
                gameItem.onclick = () => loadGame(game.name);
                gameItem.innerHTML = `
                    <img alt="${game.name} icon" src="${game.icon}" onerror="this.src='https://placehold.co/60x60/000/fff?text=ERR'">
                    <span class="game-item-title">${game.name}</span>
                `;
                gameListContainer.appendChild(gameItem);
            });
        }


        function loadGame(gameName) {
            currentGame = gameName;
            const gameScreen = document.getElementById('game-screen');
            const gameTitleDisplay = document.getElementById('game-title-display');
            const gameInfoSection = document.getElementById('game-info-section');

            // Highlight the selected game in the list
            document.querySelectorAll('.game-item').forEach(item => {
                item.classList.toggle('active', item.getAttribute('data-game-name') === gameName);
            });

            const gameSourceCode = gameSources[gameName];
            
            // Clear previous game
            gameScreen.innerHTML = '';

            if (gameSourceCode) {
                const iframe = document.createElement('iframe');
                iframe.className = 'game-iframe';
                iframe.title = gameName;
                iframe.sandbox = 'allow-scripts allow-same-origin';
                iframe.srcdoc = gameSourceCode;
                gameScreen.appendChild(iframe);
            } else {
                // Fallback for games without embedded source (like Galaga, Frogger)
                gameScreen.innerHTML = `<div class="w-full h-full flex items-center justify-center bg-black border-2 border-dashed border-green-500 rounded-md"> <p class="text-xl text-gray-400">"${gameName}" game would load here.</p> </div>`;
            }

            gameTitleDisplay.textContent = gameName.toUpperCase();
            gameTitleDisplay.style.display = 'block';
            gameInfoSection.style.display = 'flex';
            updateLeaderboard(gameName);
            updateComments(gameName);
            document.getElementById('comment-input-field').value = '';
        }

        function updateLeaderboard(gameName) {
            const leaderboardContent = document.getElementById('leaderboard-content');
            leaderboardContent.innerHTML = '';
            const data = (gameData[gameName] && gameData[gameName].leaderboard) || [];
            if (data.length === 0) {
                leaderboardContent.innerHTML = '<p class="text-center text-gray-400 py-4">No scores yet.</p>';
                return;
            }
            data.sort((a, b) => b.score - a.score).forEach(item => {
                const div = document.createElement('div');
                div.className = 'leaderboard-item';
                div.innerHTML = `<span>${item.name}</span><span>${item.score}</span>`;
                leaderboardContent.appendChild(div);
            });
        }

        function updateComments(gameName) {
            const commentsContent = document.getElementById('comments-content');
            commentsContent.innerHTML = '';
            const data = (gameData[gameName] && gameData[gameName].comments) || [];
            if (data.length === 0) {
                commentsContent.innerHTML = '<p class="text-center text-gray-400 py-4">Be the first to comment!</p>';
                return;
            }
            data.forEach(item => {
                const div = document.createElement('div');
                div.className = 'comment-item';
                div.innerHTML = `<span class="font-bold text-purple-400">${item.user}:</span><span class="text-sm mt-1">${item.text}</span>`;
                commentsContent.appendChild(div);
            });
        }

        function addComment() {
            if (!currentGame) {
                console.warn("Please select a game first!");
                return;
            }
            const commentInput = document.getElementById('comment-input-field');
            const commentText = commentInput.value.trim();
            if (commentText === '') {
                console.warn("Comment cannot be empty!");
                return;
            }
            if (!gameData[currentGame]) {
                gameData[currentGame] = {
                    leaderboard: [],
                    comments: []
                };
            }
            if (!gameData[currentGame].comments) {
                gameData[currentGame].comments = [];
            }
            gameData[currentGame].comments.unshift({
                user: 'Player',
                text: commentText
            });
            updateComments(currentGame);
            commentInput.value = '';
        }

        // --- Initial Load ---
        document.addEventListener('DOMContentLoaded', () => {
            populateGameList();
        });
    </script>
</body>
</html>
